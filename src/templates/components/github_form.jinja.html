<div class="relative">
    <div class="w-full h-full absolute inset-0 bg-black rounded-xl translate-y-2 translate-x-2"></div>
    <div class="rounded-xl relative z-20 pl-8 sm:pl-10 pr-8 sm:pr-16 py-8 border-[3px] border-gray-900 bg-[#fff4da]">
        <img src="https://cdn.devdojo.com/images/january2023/shape-1.png"
            class="absolute md:block hidden left-0 h-[4.5rem] w-[4.5rem] bottom-0 -translate-x-full ml-3">

        <form class="flex md:flex-row flex-col w-full h-full justify-center items-stretch space-y-5 md:space-y-0 md:space-x-5"
            id="ingestForm" onsubmit="handleSubmit(event{% if is_index %}, true{% endif %})">
            <div class="relative w-full h-full">
                <div class="w-full h-full rounded bg-gray-900 translate-y-1 translate-x-1 absolute inset-0 z-10"></div>
                <input type="text" name="input_text" id="input_text" placeholder="https://github.com/..."
                    value="{{ github_url if github_url else '' }}"
                    required
                    class="border-[3px] w-full relative z-20 border-gray-900 placeholder-gray-600 text-lg font-medium focus:outline-none py-3.5 px-6 rounded">
            </div>
            <div class="relative w-auto flex-shrink-0 h-full group">
                <div class="w-full h-full rounded bg-gray-800 translate-y-1 translate-x-1 absolute inset-0 z-10"></div>
                <button type="submit"
                    class="py-3.5 rounded px-6 group-hover:-translate-y-px group-hover:-translate-x-px ease-out duration-300 z-20 relative w-full border-[3px] border-gray-900 font-medium bg-[#ffc480] tracking-wide text-lg flex-shrink-0 text-gray-900">
                    Ingest
                </button>
            </div>
        </form>

        <div class="mt-5 relative z-20 w-[30%]">
            <label for="file_size" class="block text-gray-700 mb-2">Include files under: <span id="size_value" class="font-bold">68kb</span></label>
            <input type="range" 
                id="file_size" 
                name="max_file_size"
                min="0" 
                max="500" 
                value="{{ default_file_size }}"
                class="w-full h-3 
                       bg-[#FE4A60]                    <!-- This defines the left (filled) part color -->
                       bg-no-repeat 
                       bg-[length:50%_100%] 
                       bg-[#FFF4DA]                    <!-- This defines the right (unfilled) part color -->
                       appearance-none 
                       border-[3px] 
                       border-gray-900 
                       rounded-sm 
                       focus:outline-none 
                       bg-gradient-to-r from-[#FE4A60] to-[#FE4A60] 
                       [&::-webkit-slider-thumb]:appearance-none 
                       [&::-webkit-slider-thumb]:w-6 
                       [&::-webkit-slider-thumb]:h-6 
                       [&::-webkit-slider-thumb]:bg-white 
                       [&::-webkit-slider-thumb]:border-[3px] 
                       [&::-webkit-slider-thumb]:border-black 
                       [&::-webkit-slider-thumb]:rounded-sm 
                       [&::-webkit-slider-thumb]:cursor-pointer 
                       [&::-webkit-slider-thumb]:shadow-[1px_1px_0_#000] 
                       [&::-webkit-slider-thumb]:border-black 
                       [&::-webkit-slider-thumb]:shadow-[inset_0_0_0_2px_rgb(17,24,39),1px_1px_0_#000] 
                       [&::-webkit-slider-thumb]:-mr-[10px]">
        </div>

        {% if show_examples %}
        <!-- Example repositories section -->
        <div class="mt-4">
            <p class="opacity-70 mb-3">Try these example repositories:</p>
            <div class="flex flex-wrap gap-2">
                {% for example in examples %}
                <button onclick="submitExample('{{ example.url }}')"
                    class="px-4 py-2 bg-[#FFFDF8] hover:bg-gray-100 text-gray-900 rounded transition-colors duration-200 border-[3px] border-gray-900 relative hover:-translate-y-px hover:-translate-x-px">
                    {{ example.name }}
                </button>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div> 

<script>
document.addEventListener('DOMContentLoaded', function() {
    const slider = document.getElementById('file_size');
    const sizeValue = document.getElementById('size_value');
    const form = document.getElementById('ingestForm');

    // Convert linear slider value (0-500) to logarithmic size (1KB to 100MB)
    function logSliderToSize(position) {
        const minp = 0;
        const maxp = 500;
        const minv = Math.log(1);
        const maxv = Math.log(102400);

        const scale = (maxv - minv) / (maxp - minp);
        const value = Math.exp(minv + scale * (position - minp));
        return Math.round(value);
    }

    function formatSize(sizeInKB) {
        if (sizeInKB >= 1024) {
            return Math.round(sizeInKB / 1024) + 'mb';
        }
        return Math.round(sizeInKB) + 'kb';
    }

    function updateSlider() {
        const value = logSliderToSize(slider.value);
        sizeValue.textContent = formatSize(value);
        // Update the background size
        slider.style.backgroundSize = `${(slider.value / slider.max) * 100}% 100%`;
    }

    // Initialize slider
    if (slider) {
        updateSlider(); // This will now update both the label and background on load
    }

    // Update on slider change
    slider.addEventListener('input', updateSlider);

    // Add form submit handler to convert size before sending
    form.addEventListener('submit', function(e) {
        // Get the actual KB value from the slider
        const kbValue = logSliderToSize(slider.value);
        
        // Create a hidden input to send the actual KB value
        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'max_file_size';
        hiddenInput.value = kbValue;
        
        // Replace the original slider input in the form submission
        form.appendChild(hiddenInput);
    });
});


</script> 